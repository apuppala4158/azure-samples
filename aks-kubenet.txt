    # Setup environment variables
    RG_NAME=""
    AZ_REGION=""
    VNET_NAME=""
    VNET_PREFIX=""
    SUBNET1_NAME=""
    SUBNET1_PREFIX=""
    SUBNET2_NAME=""  ## Optional
    SUBNET2_PREFIX="" ## Optional
    CLUSTER_NAME=""
    EGRESS_PUBIP="" ## Use if you want to give your cluster a static IP for outbound access
    NETWORK_PLUGIN="kubenet"
    NETWORK_POLICY="calico"
    ACR_NAME=""
    SP_NAME=""

    # Create a resource group
    az group create --name $RG_NAME --location $AZ_REGION

    # Create a virtual network and subnets
    az network vnet create \
	    --name $VNET_NAME \
	    --address-prefixes $VNET_PREFIX \
        --resource-group $RG_NAME
    az network vnet subnet create \
        --name "$SUBNET1_NAME" \
        --address-prefixes "$SUBNET1_PREFIX" \
        --resource-group $RG_NAME \
        --vnet-name $VNET_NAME
    az network vnet subnet create \
        --name "$SUBNET2_NAME" \
        --address-prefixes "$SUBNET2_PREFIX" \
        --resource-group $RG_NAME \
        --vnet-name $VNET_NAME

    # Create PublcIP for Egress
    az network public-ip create \
        --name $EGRESS_PUBIP_WEST \
        --sku standard \
        --resource-group $RG_NAME

    # Create a service principal and read in the application ID
    SP=$(az ad sp create-for-rbac -n $SP_NAME --skip-assignment)
    SP_ID=$(echo $SP | jq -r .appId)
    SP_PASSWORD=$(echo $SP | jq -r .password)

    # Wait 15 seconds to make sure that service principal has propagated
    echo "Waiting for service principal to propagate..."
    sleep 15

    # Get the virtual network resource ID
    VNET_ID=$(az network vnet show --resource-group $RG_NAME --name $VNET_NAME --query id -o tsv)

    # Assign the service principal Owner permissions to the virtual network resource
    az role assignment create --assignee $SP_ID --scope $VNET_ID --role Owner

    # Get the virtual network subnet resource ID
    SUBNET1_ID=$(az network vnet subnet show --resource-group $RG_NAME --vnet-name $VNET_NAME --name $SUBNET1_NAME --query id -o tsv)
    SUBNET2_ID=$(az network vnet subnet show --resource-group $RG_NAME --vnet-name $VNET_NAME --name $SUBNET2_NAME --query id -o tsv)

    # Create the AKS cluster and specify the virtual network and service principal information
    # Enable network policy by using the `--network-policy` parameter
    az aks create \
        --name $CLUSTER_NAME \
        --resource-group $RG_NAME \
        --vm-set-type VirtualMachineScaleSets \
        --node-count 3 \
        --generate-ssh-keys \
        --load-balancer-sku standard \
        --network-plugin $NETWORK_PLUGIN \
        --enable-cluster-autoscaler \
        --min-count 3 \
        --max-count 6 \
        --service-cidr 10.0.0.0/16 \
        --dns-service-ip 10.0.0.10 \
        --docker-bridge-address 172.17.0.1/16 \
        --vnet-subnet-id $SUBNET1_ID \
        --service-principal $SP_ID \
        --client-secret $SP_PASSWORD

    # Attach ACR
    az aks update -n $CLUSTER_NAME -g $RG_NAME --attach-acr $ACR_NAME

    # Find ID of public IP, if created above
    EGRESS_ID=$(az network public-ip show --resource-group $RG_NAME --name $EGRESS_PUBIP --query id -o tsv)

    # Update cluster to use custom IP for outbound access
    az aks update \
        --resource-group $RG_NAME \
        --name $CLUSTER_NAME \
        --load-balancer-outbound-ips $EGRESS_ID

    # Assign the service principal Owner permissions to the virtual network resource
    az role assignment create --assignee $SP_ID --scope $EGRESS_ID --role Owner

    # Get credentials to login
    az aks get-credentials --resource-group $RESOURCE_GROUP_NAME --name $CLUSTER_NAME